version: '3'

networks:
  frontend:
    driver: ${NETWORKS_DRIVER}
  backend:
    driver: ${NETWORKS_DRIVER}

services:
    tiptapsocketserver:
      container_name: tiptapsocket
      image: node:12.10-alpine
      command: npm run start-dev
      environment:
        - MONGODB_URI=${MONGODB_URI}
      working_dir: /app
      volumes:
        - ./:/app
      ports:
        - "${SOCKETPORT}:3000"
      tty: true
      networks:
        - frontend
        - backend

    mongo:
      container_name: mongo
      image: mongo:latest
      command: mongod
      environment:
        - MONGO_INITDB_ROOT_USERNAME=mongoadmin
        - MONGO_INITDB_ROOT_PASSWORD=secret
        - MONGO_INITDB_DATABASE=tiptap_collabdb
      ports:
        - "${MONGODB_PORT}:27017"
      volumes:
        - ${DATA_PATH_HOST}/mongo:/data/db
        - .docker/mongo-init.js:/docker-entrypoint-initdb.d/mongo-init.js:ro
      networks:
        - backend